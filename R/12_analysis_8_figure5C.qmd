---
title: "12_analysis_8_Function_Boxplot"
author: "Group 29"
format: html
editor: visual
---

## Loading Libraries

```{r}
#| eval: true
library(ggplot2)
library(dplyr)
library(readr)
```

## Loading Data

```{r}
data <- read_tsv("../data/03_dat_aug.tsv")
```

## Creating Function

```{r}
name_me1 <- function(column_name){
  column_name <- enquo(column_name)
  
  relevant_data <- data |> 
    select(RXHEP, RXASP, !!column_name) 
  
  percentage_data <- relevant_data |>
  #Counts the patients in each group
      group_by(RXHEP, RXASP, !!column_name) |> 
      count() |> 
      #Creates the six groups examined
      group_by(RXHEP, RXASP) |>
      #Creates a row with percentages for use in plot
      mutate(total_in_group = sum(n),
             percentage = n / total_in_group * 100,
             p = n / total_in_group,
             se = sqrt(p * (1 - p) / total_in_group) * 100) |> 
    #Removes all patients with no reported pulmonary embolism
      filter(!!column_name != "N") 
  
  sorted_data <- percentage_data |> 
    mutate(RXHEP = factor(RXHEP, levels = c("M", "L", "N")),
           RXASP = factor(RXASP, levels = c("Y", "N")))
  
  plot_box <- sorted_data |>   
    ggplot(aes(x = RXHEP,
               y = percentage,
               fill = RXASP,
               ymin = percentage - se,
               ymax = percentage + se)) +
    geom_col(position = position_dodge(preserve = "single"),
             alpha = 0.7,
             color = "black") +
    geom_text(aes(label = round(percentage, 2)),
              position = position_dodge(width = 0.9),
              vjust = -0.5,
              size = 3) +
    geom_errorbar(position = position_dodge(width = 0.9),
                  width = 0.3) +
    labs(title = "Percentage of patients with XXXX",
         subtitle = "XXX",
         x = NULL,
         y = "%",
         fill = "Aspirin Dosing") +
    scale_fill_brewer(palette = "Dark2",
                      labels = c("Y" = "300 mg daily",
                                   "N" = "No Aspirin")) +
    theme_minimal() +
    theme(legend.position = "bottom",
          axis.title.y = element_text(angle = 0, vjust = 0.5),
          panel.grid.major.x = element_blank()) +
    scale_x_discrete(labels = c("M" = "12500 IU Heparin",
                                "L" = "5000 IU Heparin",
                                "N" = "No Heparin"))
  
  return(plot_box)
}

name_me1(TRAN14)
```

test
