---
title: "06_analysis_2"
author: "Group 29: Helena MÃ¸ller, Emma Christensen, Frederik Holmstrup, Casper Harreby & Laura Christiansen"
format: html
execute: 
  message: FALSE
  warning: FALSE
---

# Data modeling

This analysis investigates whether`AGE` can predict the following probabilities making a simple linear model for prediction of:

-   `EXPDD` (Predicted probability of death/dependence at 6 month)

-   `EXPD6` (Predicted probability of death at 6 months)

-   `EXPD14` (Predicted probability of death at 14 days)

We will visualize the relationships between `AGE` and these outcomes using scatter plots.

## Loading Libraries

```{r}
#| eval: true
#| echo: true

library("tidyverse") 
library("ggplot2") 
library("dplyr") 
library("readr") 
library("here")
```

## Import the dataset

```{r}

# Load the dataset   
data <- read_tsv(here("data/03_dat_aug.tsv"))
```

### Model 1: Predicting `EXPDD` with `AGE`

**Linear regression:**

```{r}

# Linear regression for EXPDD 
model_1 <- data |> 
  filter(STYPE == "LACS") |> 
  lm(data = _,
     EXPDD ~ AGE)
```

```{r}

# Display model summary 
model_1 |> 
  summary()
```

```{r}


# Plot AGE vs log10(EXPDD) to observe the relationship
p1 <- data |> 
  filter(STYPE == "LACS") |> 
  ggplot(aes(x = AGE, y = log10(EXPDD))) +
  geom_point(color = "purple") +
  labs(
    title = "AGE vs. Predicted Death/Dependence Probability at 6 Months",
    x = "Age (Years)",
    y = "log10(Predicted Death/Dependence Probability)",
    caption = "Relationship modeled using simple linear regression"
  ) +
  theme_minimal()

print(p1)

```

### Model 2: Predicting `EXPD6` with `AGE`

**Linear regression:**

```{r}

# Linear regression for EXPD6
model_2 <- data |> 
  filter(STYPE == "LACS") |> 
  lm(data = _,
     log2(EXPD6) ~ AGE)
```

**Model summary:**

```{r}

# Display model summary 
model_2 |> 
  summary()
```

**Visualization:**

```{r}

# Plot AGE vs log2(EXPD6) to observe the relationship
p2 <- data |> 
  filter(STYPE == "LACS") |> 
  ggplot(aes(x = AGE, y = log2(EXPD6))) +
  geom_point(color = "blue") +
  labs(
    title = "AGE vs. Predicted Death Probability at 6 Months",
    x = "Age (Years)",
    y = "log2(Predicted Death Probability)",
    caption = "Relationship modeled using simple linear regression"
  ) +
  theme_minimal()

print(p2)
```

### Model 3: Predicting `EXPD14` with `AGE`

**Linear regression:**

```{r}

# Linear regression for EXPD14
model_3 <- data |> 
  filter(STYPE == "LACS") |> 
  lm(data = _, log2(EXPD14) ~ AGE)
```

**Model summary:**

```{r}

# Display model summary
model_3 |> 
  summary()
```

**Visualization:**

```{r}

# Plot AGE vs log2(EXPD14) to observe the relationship
p3 <- data |> 
  filter(STYPE == "LACS") |> 
  ggplot(aes(x = AGE, y = log2(EXPD14))) +
  geom_point(color = "red") +
  labs(
    title = "AGE vs. Predicted Death Probability at 14 Days",
    x = "Age (Years)",
    y = "log2(Predicted Death Probability)",
    caption = "Relationship modeled using simple linear regression"
  ) +
  theme_minimal()

print(p3)
```

## Saving Plots

To document the results, the plots are saved in the `results` folder.

```{r}

ggsave(filename = here("results/06_keyplot_2a.png"), 
       plot = p1, 
       width = 8, 
       height = 4, 
       dpi = 300, 
       bg = "white")  
ggsave(filename = here("results/06_keyplot_2b.png"), 
       plot = p2, 
       width = 8, 
       height = 4, 
       dpi = 300, 
       bg = "white")
ggsave(filename = here("results/06_keyplot_2c.png"), 
       plot = p3, 
       width = 8, 
       height = 4, 
       dpi = 300, 
       bg = "white")
```
